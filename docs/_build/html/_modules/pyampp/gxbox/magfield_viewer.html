

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyampp.gxbox.magfield_viewer &mdash; pyAMPP 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyAMPP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../model_hdf5_format.html">pyAMPP HDF5 Model Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gui_workflow.html">pyAMPP GUI Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../viewers.html">Model Viewers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html#id1">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyAMPP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyampp.gxbox.magfield_viewer</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyampp.gxbox.magfield_viewer</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> \
    <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QMenu</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QToolButton</span><span class="p">,</span> \
    <span class="n">QToolBar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5agg</span><span class="w"> </span><span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5agg</span><span class="w"> </span><span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyampp.gxbox.boxutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_number</span><span class="p">,</span> <span class="n">read_b3d_h5</span><span class="p">,</span> <span class="n">write_b3d_h5</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">vtk</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvistaqt</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackgroundPlotter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QTreeView</span><span class="p">,</span> \
    <span class="n">QGroupBox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QStandardItemModel</span><span class="p">,</span> <span class="n">QStandardItem</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1">## todo is it possible to add 3d crosshair to the plotter?</span>
<span class="c1">## todo integrate NLFFF extrapolation module. https://github.com/Alexey-Stupishin/pyAMaFiL</span>
<div class="viewcode-block" id="minval">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.minval">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">minval</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rounds the minimum value to the nearest hundredth.</span>

<span class="sd">    :param min_val: float</span>
<span class="sd">        The minimum value to round.</span>
<span class="sd">    :return: float</span>
<span class="sd">        The rounded minimum value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_val</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span></div>



<div class="viewcode-block" id="maxval">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.maxval">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maxval</span><span class="p">(</span><span class="n">max_val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rounds the maximum value to the nearest hundredth.</span>

<span class="sd">    :param max_val: float</span>
<span class="sd">        The maximum value to round.</span>
<span class="sd">    :return: float</span>
<span class="sd">        The rounded maximum value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">max_val</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span></div>



<div class="viewcode-block" id="MagFieldViewer">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MagFieldViewer</span><span class="p">(</span><span class="n">BackgroundPlotter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to visualize the magnetic field of a box using PyVista. It inherits from the BackgroundPlotter class.</span>

<span class="sd">    :param box: object</span>
<span class="sd">        The box containing magnetic field data.</span>
<span class="sd">    :param parent: object, optional</span>
<span class="sd">        The parent object (default is None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">box_norm_direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">box_view_up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b3dtype</span><span class="o">=</span><span class="s1">&#39;nlfff&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<div class="viewcode-block" id="MagFieldViewer.box">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.box">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">box</span></div>

<div class="viewcode-block" id="MagFieldViewer.parent">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.parent">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span></div>

<div class="viewcode-block" id="MagFieldViewer.box_norm_direction">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.box_norm_direction">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_norm_direction</span> <span class="o">=</span> <span class="n">box_norm_direction</span></div>

<div class="viewcode-block" id="MagFieldViewer.box_view_up">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.box_view_up">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_view_up</span> <span class="o">=</span> <span class="n">box_view_up</span></div>

<div class="viewcode-block" id="MagFieldViewer.updating_flag">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.updating_flag">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">updating_flag</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag to avoid recursion</span></div>

<div class="viewcode-block" id="MagFieldViewer.spheres">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.spheres">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="MagFieldViewer.current_sphere_id">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.current_sphere_id">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.next_sphere_id">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.next_sphere_id">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="MagFieldViewer.current_sphere">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.current_sphere">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.sphere_actor">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.sphere_actor">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_actor</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.sphere">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.sphere">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.axes_widget">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.axes_widget">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes_widget</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.plane_actor">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.plane_actor">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.bottom_slice_actor">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.bottom_slice_actor">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.streamlines_actor">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.streamlines_actor">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.streamlines">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.streamlines">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.sphere_visible">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.sphere_visible">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_visible</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MagFieldViewer.plane_visible">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.plane_visible">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_visible</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MagFieldViewer.use_interp">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.use_interp">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_interp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MagFieldViewer.scalar">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.scalar">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span> <span class="o">=</span> <span class="s1">&#39;bz&#39;</span></div>

<div class="viewcode-block" id="MagFieldViewer.previous_params">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.previous_params">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="MagFieldViewer.previous_valid_values">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.previous_valid_values">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="MagFieldViewer.scalar_selector">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.scalar_selector">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.scalar_selector_items">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.scalar_selector_items">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector_items</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="MagFieldViewer.center_x_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.center_x_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.center_y_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.center_y_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.center_z_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.center_z_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.radius_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.radius_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.n_points_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.n_points_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.slice_z_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.slice_z_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.vmin_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.vmin_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.vmax_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.vmax_input">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.slice_z_min">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.slice_z_min">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_min</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="MagFieldViewer.slice_z_max">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.slice_z_max">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_max</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="MagFieldViewer.scalar_min">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.scalar_min">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="MagFieldViewer.scalar_max">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.scalar_max">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="MagFieldViewer.update_button">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_button">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_button</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.send_button">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.send_button">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.parallel_proj_button">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.parallel_proj_button">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MagFieldViewer.timestr">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.timestr">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;_%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span></div>

        <span class="k">if</span> <span class="n">b3dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pot&quot;</span><span class="p">,</span> <span class="s2">&quot;nlfff&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="s2">&quot;corona&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corona_type</span> <span class="o">=</span> <span class="n">b3dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="n">b3dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corona_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.sphere_checkbox = None</span>
<div class="viewcode-block" id="MagFieldViewer.grid_x">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.grid_x">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">grid_coords</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="MagFieldViewer.grid_y">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.grid_y">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">grid_coords</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="MagFieldViewer.grid_z">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.grid_z">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">grid_coords</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span></div>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmax</span> <span class="o">=</span> <span class="n">minval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">maxval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymax</span> <span class="o">=</span> <span class="n">minval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">maxval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span> <span class="o">=</span> <span class="n">minval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">maxval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<div class="viewcode-block" id="MagFieldViewer.grid_zbase">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.grid_zbase">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_zbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span></div>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zbase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<div class="viewcode-block" id="MagFieldViewer.default_sph_cen_x">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.default_sph_cen_x">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">)</span></div>

<div class="viewcode-block" id="MagFieldViewer.default_sph_cen_y">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.default_sph_cen_y">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">)</span></div>

<div class="viewcode-block" id="MagFieldViewer.default_sph_cen_z">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.default_sph_cen_z">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span></div>


        <span class="c1"># self.init_ui()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_widgets_to_window</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_axes_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_isometric</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;GxBox 3D viewer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_menu_options</span><span class="p">()</span>  <span class="c1"># Add this line to include menu options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parallel_projection_button</span><span class="p">()</span> <span class="c1"># Add parallel projection button</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_norm_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_view_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_observer_cam_button</span><span class="p">()</span>  <span class="c1"># Add this line to include the observer cam button</span>

        <span class="c1">## Connect the camera modified event to the callback function</span>
        <span class="c1"># self.interactor.AddObserver(&#39;ModifiedEvent&#39;, self.print_camera_position)</span>

<div class="viewcode-block" id="MagFieldViewer.print_camera_position">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.print_camera_position">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_camera_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the camera position whenever the camera is moved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">position</span>
        <span class="n">focal_point</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span>
        <span class="n">view_up</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">up</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera position: </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Focal point: </span><span class="si">{</span><span class="n">focal_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;View up: </span><span class="si">{</span><span class="n">view_up</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.set_camera_to_LOS_direction">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.set_camera_to_LOS_direction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera_to_LOS_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the camera to align with the normal direction vector of the observer&#39;s line of sight (LoS).</span>

<span class="sd">        This function reorients the camera so that it points along the observer&#39;s normal direction</span>
<span class="sd">        while ensuring the &#39;view up&#39; vector is aligned to the target y-axis (0, 1, 0).</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Normalize the provided view up vector.</span>
<span class="sd">            2. Calculate the rotation axis using the cross product of the normalized view up vector</span>
<span class="sd">               and the target y-axis.</span>
<span class="sd">            3. Compute the angle between the normalized view up vector and the target y-axis.</span>
<span class="sd">            4. Generate a rotation matrix using Rodrigues&#39; rotation formula.</span>
<span class="sd">            5. Apply the rotation matrix to adjust the view up vector.</span>
<span class="sd">            6. Set the camera position to align with the normal direction and update the focal point.</span>
<span class="sd">            7. Enable parallel projection for the camera.</span>

<span class="sd">        :raises ValueError: If the norm of the view up vector is zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Normalizes a vector.</span>

<span class="sd">            :param v: array_like</span>
<span class="sd">                The vector to normalize.</span>
<span class="sd">            :return: array_like</span>
<span class="sd">                The normalized vector.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">return</span> <span class="n">v</span> <span class="o">/</span> <span class="n">norm</span>

        <span class="c1"># Normalize the view up vector</span>
        <span class="n">view_up_normalized</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_view_up</span><span class="p">)</span>

        <span class="c1"># Define the target y-axis</span>
        <span class="n">target_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Compute the axis of rotation (cross product)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">view_up_normalized</span><span class="p">,</span> <span class="n">target_y</span><span class="p">)</span>
        <span class="n">axis_normalized</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">view_up_normalized</span><span class="p">,</span> <span class="n">target_y</span><span class="p">))</span>

        <span class="c1"># Compute the rotation matrix using Rodrigues&#39; rotation formula</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">axis_normalized</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis_normalized</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">axis_normalized</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">axis_normalized</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">axis_normalized</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis_normalized</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="c1"># Apply the rotation matrix to adjust the view up vector</span>
        <span class="n">view_up_rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">view_up_normalized</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="n">view_up_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">view_up_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">view_up_rot</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

        <span class="c1"># Set the camera position to align with the normal direction</span>
        <span class="n">camera_position</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">box_norm_direction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">box_norm_direction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_norm_direction</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">camera_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="MagFieldViewer.add_parallel_projection_button">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.add_parallel_projection_button">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_parallel_projection_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a toggle button for parallel projection to the toolbar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QToolBar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toolbar</span><span class="p">:</span>
            <span class="c1"># Create Parallel Projection button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Parallel Proj.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Toggle parallel projection&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">GetParallelProjection</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_parallel_projection</span><span class="p">)</span>

            <span class="c1"># Find the &quot;Reset&quot; button and insert the separator and parallel projection button after it</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">toolbar</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Reset&quot;</span><span class="p">:</span>
                    <span class="c1"># toolbar.insertSeparator(action)</span>
                    <span class="n">toolbar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_proj_button</span><span class="p">)</span>
                    <span class="c1"># toolbar.insertSeparator(action)</span>
                    <span class="k">break</span></div>


<div class="viewcode-block" id="MagFieldViewer.toggle_parallel_projection">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.toggle_parallel_projection">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_parallel_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the parallel projection mode of the camera.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">ParallelProjectionOn</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">ParallelProjectionOff</span><span class="p">()</span></div>



<div class="viewcode-block" id="MagFieldViewer.add_observer_cam_button">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.add_observer_cam_button">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_observer_cam_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a button to the toolbar to set the camera to the normal direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QToolBar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toolbar</span><span class="p">:</span>
            <span class="n">observer_cam_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
            <span class="n">observer_cam_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;LoS&quot;</span><span class="p">)</span>
            <span class="n">observer_cam_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the camera to the observer&#39;s normal direction&quot;</span><span class="p">)</span>
            <span class="n">observer_cam_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_camera_to_LOS_direction</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">toolbar</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Isometric&quot;</span><span class="p">:</span>
                    <span class="n">toolbar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">observer_cam_button</span><span class="p">)</span>
                    <span class="k">break</span></div>


<div class="viewcode-block" id="MagFieldViewer.add_menu_options">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.add_menu_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_menu_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">menubar</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;File&quot;</span><span class="p">:</span>
                <span class="n">file_menu</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">file_menu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_menu</span> <span class="o">=</span> <span class="n">menubar</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">)</span>

        <span class="n">load_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Load State&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="p">)</span>
        <span class="n">load_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_state</span><span class="p">)</span>

        <span class="n">save_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Save State&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="p">)</span>
        <span class="n">save_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;magfield_viewer_state</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timestr</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">))</span>

        <span class="c1"># Find the position of the separator and insert the new actions above it</span>
        <span class="n">separator_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">file_menu</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">isSeparator</span><span class="p">():</span>
                <span class="n">separator_action</span> <span class="o">=</span> <span class="n">action</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">separator_action</span><span class="p">:</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="n">separator_action</span><span class="p">,</span> <span class="n">load_action</span><span class="p">)</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="n">separator_action</span><span class="p">,</span> <span class="n">save_action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">load_action</span><span class="p">)</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">save_action</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.save_state">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.save_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default_filename</span><span class="o">=</span><span class="s1">&#39;magfield_viewer_state.pkl&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current state of spheres to a file. Prompts the user to select a directory and input a filename.</span>

<span class="sd">        :param default_filename: str</span>
<span class="sd">            The default name of the file to save the state data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">|=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="p">,</span> <span class="s2">&quot;Save State&quot;</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span>
                                                  <span class="s2">&quot;Pickle Files (*.pkl)&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># Create a serializable version of the spheres</span>
            <span class="n">serializable_spheres</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">sphere_id</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;n_points&#39;</span><span class="p">:</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;n_points&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;sphere_visible&#39;</span><span class="p">:</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;sphere_visible&#39;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">sphere_id</span><span class="p">,</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">serializable_spheres</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.load_state">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.load_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the state of spheres from a file. Prompts the user to select a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>
            <span class="n">options</span> <span class="o">|=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="p">,</span> <span class="s2">&quot;Load State&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;magfield_viewer_state</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timestr</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">,</span> <span class="s2">&quot;Pickle Files (*.pkl)&quot;</span><span class="p">,</span>
                                                      <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">serializable_spheres</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_on_clear_spheres</span><span class="p">()</span>

            <span class="c1"># Recreate the spheres from the serializable data</span>
            <span class="k">for</span> <span class="n">sphere_id</span><span class="p">,</span> <span class="n">sphere_data</span> <span class="ow">in</span> <span class="n">serializable_spheres</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Update the sphere control widgets</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">,</span> <span class="n">sphere_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_data</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_data</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_data</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_data</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_data</span><span class="p">[</span><span class="s1">&#39;n_points&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Add the sphere using the _on_add_sphere method</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_add_sphere</span><span class="p">()</span>

                <span class="c1"># Update the sphere visibility</span>
                <span class="c1"># self.update_sphere_visibility(sphere_data[&#39;sphere_visible&#39;])</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State loaded from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.add_widgets_to_window">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.add_widgets_to_window">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_widgets_to_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the input widgets to the window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the central widget&#39;s layout</span>
        <span class="n">central_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">()</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">central_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>

        <span class="c1"># if main_layout is None:</span>
        <span class="c1">#     main_layout = QHBoxLayout()</span>
        <span class="c1">#     central_widget.setLayout(main_layout)</span>

        <span class="n">control_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="n">field_lines_control_group</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Field Line Browser&quot;</span><span class="p">)</span>
        <span class="n">field_lines_control_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">field_lines_control_group</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">field_lines_control_layout</span><span class="p">)</span>
        <span class="n">field_lines_control_group</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">field_lines_control_group</span><span class="p">)</span>


        <span class="c1"># Create and add the tree view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span> <span class="o">=</span> <span class="n">QTreeView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span> <span class="o">=</span> <span class="n">QStandardItemModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;Sphere&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="p">)</span>

        <span class="c1"># Align the text to the left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QTreeView::item { text-align: left; }&quot;</span><span class="p">)</span>

        <span class="c1"># Adjust the maximum width to ensure it fits the content properly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">110</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span>

        <span class="c1"># Resize the columns to fit the contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Stretch the last section to fill the width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>  <span class="c1"># Resize the section to fill the width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_tb_selection_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_tb_right_click</span><span class="p">)</span>
        <span class="n">field_lines_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="p">)</span>

        <span class="n">spheres_manage_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">button_width</span> <span class="o">=</span> <span class="mi">35</span>  <span class="c1"># Set a fixed width for each button</span>

        <span class="c1"># In add_widgets_to_window method, add the &quot;+&quot; button near the QTreeView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Add a sphere&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_button</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="n">button_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_add_sphere</span><span class="p">)</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Delete the elected sphere&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_button</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="n">button_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_delete_sphere</span><span class="p">)</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_sphere_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Clear all spheres&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_sphere_button</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="n">button_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_sphere_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_clear_spheres</span><span class="p">)</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_sphere_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Use a suitable symbol for status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Hide the sphere&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="n">button_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_sphere_visibility</span><span class="p">)</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="p">)</span>

        <span class="c1"># Ensure the layout is aligned</span>
        <span class="n">spheres_manage_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">field_lines_control_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">spheres_manage_layout</span><span class="p">)</span>

        <span class="c1"># Create and add the properties panel</span>
        <span class="n">properties_panel</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">properties_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">properties_panel</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">properties_layout</span><span class="p">)</span>
        <span class="n">properties_panel</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">properties_panel</span><span class="p">)</span>

        <span class="c1"># Add widgets to the layout</span>
        <span class="c1"># Slice Control Group</span>
        <span class="n">slice_control_group</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Slice Z&quot;</span><span class="p">)</span>
        <span class="n">slice_control_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="n">slice_z_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Z [Mm]:&quot;</span><span class="p">)</span>
        <span class="n">slice_z_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter the Z coordinate for the slice in the range of 0 to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mm.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setAccelerated</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_slice_z_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Use arrows or mouse wheel. Range: 0 to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mm.&quot;</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">slice_z_label</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">)</span>

        <span class="n">scalar_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select Scalar:&quot;</span><span class="p">)</span>
        <span class="n">scalar_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Select the scalar field to display on the slice.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">scalar_label</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span><span class="p">)</span>

        <span class="n">vmin_vmax_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Vmin/Vmax [G]:&quot;</span><span class="p">)</span>
        <span class="n">vmin_vmax_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Enter the minimum and maximum values for the color scale.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mf">5e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setAccelerated</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_vmin_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Use arrows or mouse wheel to change Vmin.&quot;</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">vmin_vmax_label</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mf">5e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setAccelerated</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_vmax_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Use arrows or mouse wheel to change Vmax.&quot;</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plane_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Show Plane&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_plane_visibility</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plane_checkbox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Interpolate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Toggle interpolation for slice display.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span><span class="p">)</span>
        <span class="n">slice_control_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>

        <span class="n">slice_control_group</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slice_control_layout</span><span class="p">)</span>
        <span class="n">properties_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">slice_control_group</span><span class="p">)</span>

        <span class="c1"># Sphere Control Group</span>
        <span class="n">sphere_control_group</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Sphere&quot;</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">center_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Location [Mm]:&quot;</span><span class="p">)</span>
        <span class="n">center_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the X, Y, and Z coordinates for the center of the sphere.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_sph_cen_z</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the X coordinate for the center of the sphere in the range of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_xmax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mm.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the Y coordinate for the center of the sphere in the range of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_ymax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mm.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the Z coordinate for the center of the sphere in the range of </span><span class="si">{</span><span class="mi">0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mm.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_center_x_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_center_y_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_center_z_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">))</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">center_label</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lock_z_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Lock Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_z_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_z_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_lock_z_changed</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_z_checkbox</span><span class="p">)</span>

        <span class="c1"># Add a separator after the Lock Z button</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="p">))</span>

        <span class="n">radius_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Radius [Mm]:&quot;</span><span class="p">)</span>
        <span class="n">radius_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the radius of the sphere.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Enter the radius of the sphere in Mm.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_radius_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">))</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">radius_label</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">)</span>

        <span class="n">n_points_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;# of Field Lines:&quot;</span><span class="p">)</span>
        <span class="n">n_points_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Enter the number of seed points for the field lines.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="s2">&quot;100&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Enter the number of seed points for the field lines.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_n_points_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="p">))</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">n_points_label</span><span class="p">)</span>
        <span class="n">sphere_control_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="p">)</span>

        <span class="n">sphere_control_group</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">sphere_control_layout</span><span class="p">)</span>
        <span class="n">properties_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sphere_control_group</span><span class="p">)</span>

        <span class="n">action_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Send Field Lines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;No parent object to send the field lines to.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Send the field lines to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_streamlines</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_box_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Load Box&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_box_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Load the box data from a .hd5 file.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_box_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_box</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">save_box_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save Box&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_box_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save the box data to a .hd5 file.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_box_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_box</span><span class="p">)</span>


        <span class="n">action_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_button</span><span class="p">)</span>
        <span class="n">action_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_box_button</span><span class="p">)</span>
        <span class="n">action_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_box_button</span><span class="p">)</span>

        <span class="c1"># self.update_button = QPushButton(&quot;Update&quot;)</span>
        <span class="c1"># self.update_button.clicked.connect(self.update_plot)</span>
        <span class="c1"># action_layout.addWidget(self.update_button)</span>

        <span class="c1"># self.sphere_checkbox = QCheckBox(&quot;Show Sphere&quot;)</span>
        <span class="c1"># self.sphere_checkbox.setChecked(True)</span>
        <span class="c1"># self.sphere_checkbox.stateChanged.connect(self.toggle_sphere_visibility)</span>
        <span class="c1"># action_layout.addWidget(self.sphere_checkbox)</span>

        <span class="n">properties_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">action_layout</span><span class="p">)</span>

        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">control_layout</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_add_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new sphere to the viewer and tree view, hiding the current sphere.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a new sphere and its streamlines</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>

        <span class="n">sphere_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">center_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="c1"># if keep_current_parms:</span>
        <span class="c1">#     pass</span>
        <span class="c1"># else:</span>
        <span class="c1">#     center_x = np.mean(self.grid_x)</span>
        <span class="c1">#     center_y = np.mean(self.grid_y)</span>
        <span class="c1"># center_z = self.grid_zmin + np.ptp(self.grid_z) * 0.1</span>
        <span class="n">center_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center_x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center_y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center_z</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_streamlines</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="o">=</span> <span class="n">sphere_id</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="n">sphere_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">),</span>
            <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
            <span class="s1">&#39;n_points&#39;</span><span class="p">:</span> <span class="n">n_points</span><span class="p">,</span>
            <span class="s1">&#39;sphere_actor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_actor</span><span class="p">,</span>
            <span class="s1">&#39;streamlines&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
            <span class="s1">&#39;streamlines_actor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span><span class="p">,</span>
            <span class="s1">&#39;sphere_visible&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere_visibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Add the new sphere to the tree view</span>
        <span class="n">sphere_item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">sphere_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">indexFromItem</span><span class="p">(</span><span class="n">sphere_item</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span> <span class="o">+=</span> <span class="mi">1</span>

<div class="viewcode-block" id="MagFieldViewer.select_sphere">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.select_sphere">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">select_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sphere_id</span><span class="p">):</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="n">sphere_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;n_points&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># self.spheres[self.current_sphere_id][&#39;streamlines_actor&#39;].SetVisibility(False)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>

        <span class="c1"># Restore the streamlines actor for the selected sphere</span>
        <span class="n">streamlines_actor</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span>
        <span class="n">sphere_actor</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span>

        <span class="c1"># if streamlines_actor is not None:</span>
        <span class="c1">#     streamlines_actor.SetVisibility(True)</span>
        <span class="k">if</span> <span class="n">sphere_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sphere_actor</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="o">=</span> <span class="n">sphere_id</span></div>


<div class="viewcode-block" id="MagFieldViewer.deselect_sphere">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.deselect_sphere">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">deselect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the deselection of a sphere.</span>
<span class="sd">        Clears the inputs and hides the current sphere and its streamlines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.center_x_input.clear()</span>
        <span class="c1"># self.center_y_input.clear()</span>
        <span class="c1"># self.center_z_input.clear()</span>
        <span class="c1"># self.radius_input.clear()</span>
        <span class="c1"># self.n_points_input.clear()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
            <span class="n">sphere_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span>
            <span class="n">streamlines_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sphere_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sphere_actor</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">streamlines_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">streamlines_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_tb_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="p">,</span> <span class="n">deselected</span><span class="p">):</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">indexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sphere_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_sphere</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.deselect_sphere()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_delete_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the currently selected sphere in the tree view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">indexes</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sphere_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_from_tb</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere_visibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_clear_spheres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all spheres from the tree view and clears the corresponding data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sphere_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_from_tb</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="MagFieldViewer.delete_sphere_from_tb">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.delete_sphere_from_tb">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_sphere_from_tb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sphere_id</span><span class="p">):</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sphere</span> <span class="ow">and</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sphere</span> <span class="ow">and</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sphere</span> <span class="ow">and</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
            <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">RemoveAllObservers</span><span class="p">()</span>
        <span class="c1"># Remove from tree view</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sphere_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Update next_sphere_id to be 1 plus the largest sphere index</span>
        <span class="k">if</span> <span class="n">nrows</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_sphere_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_sphere_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_sphere_id</span> <span class="o">=</span> <span class="n">max_sphere_id</span> <span class="o">+</span> <span class="mi">1</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_tb_right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_items</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">sphere_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">()</span>
            <span class="n">delete_action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">delete_action</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_sphere_from_tb</span><span class="p">(</span><span class="n">sphere_id</span><span class="p">)</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_center_x_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the center X input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_center_y_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the center Y input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_center_z_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the center Z input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_radius_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the radius input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_n_points_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the number of seeds input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_slice_z_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the slice Z input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_vmin_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the Vmin input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span>

    <span class="nd">@validate_number</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_vmax_input_returnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the return pressed event for the Vmax input.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The input widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span>

<div class="viewcode-block" id="MagFieldViewer.validate_input">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.validate_input">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">original_value</span><span class="p">,</span> <span class="n">to_int</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">paired_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">paired_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Validates the input of a QLineEdit widget and returns the value if it is valid. If the input is invalid, a warning message is displayed and the original value is restored.</span>

<span class="sd">        :param widget: QLineEdit</span>
<span class="sd">            The widget to validate.</span>
<span class="sd">        :param min_val: float</span>
<span class="sd">            The minimum valid value.</span>
<span class="sd">        :param max_val: float</span>
<span class="sd">            The maximum valid value.</span>
<span class="sd">        :param original_value: float</span>
<span class="sd">            The original value of the widget.</span>
<span class="sd">        :param to_int: bool</span>
<span class="sd">            Whether to convert the value to an integer.</span>
<span class="sd">        :param paired_widget: QLineEdit, optional</span>
<span class="sd">            The paired widget to compare the value with.</span>
<span class="sd">        :param paired_type: str, optional</span>
<span class="sd">            The type of comparison to perform with the paired widget.</span>
<span class="sd">        :return: float</span>
<span class="sd">            The valid value.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">max_val</span><span class="p">:</span>
                <span class="n">original_value</span> <span class="o">=</span> <span class="n">min_val</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">min_val</span> <span class="k">else</span> <span class="n">max_val</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="k">if</span> <span class="n">paired_widget</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paired_widget</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">):</span>
                    <span class="n">paired_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">paired_widget</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">paired_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">paired_widget</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">paired_type</span> <span class="o">==</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">paired_value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
                <span class="k">if</span> <span class="n">paired_type</span> <span class="o">==</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">paired_value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="k">if</span> <span class="n">to_int</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="n">widget</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># if paired_type == &#39;vmin&#39;:</span>
            <span class="c1">#     QMessageBox.warning(self, &quot;Invalid Input&quot;,</span>
            <span class="c1">#                         f&quot;Please enter a number between {min_val:.3f} and {max_val:.3f} that is less than the corresponding max value.&quot;)</span>
            <span class="c1"># elif paired_type == &#39;vmax&#39;:</span>
            <span class="c1">#     QMessageBox.warning(self, &quot;Invalid Input&quot;,</span>
            <span class="c1">#                         f&quot;Please enter a number between {min_val:.3f} and {max_val:.3f} that is greater than the corresponding min value.&quot;)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     QMessageBox.warning(self, &quot;Invalid Input&quot;,</span>
            <span class="c1">#                         f&quot;Please enter a number between {min_val:.3f} and {max_val:.3f}. Revert to the original value.&quot;)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">original_value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">original_value</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">original_value</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_slice_slider_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_max</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_scalar_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar_name</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">scalar_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">array_names</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scalar_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span> <span class="o">-=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="MagFieldViewer.init_grid">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.init_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">bx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span><span class="p">][</span><span class="s1">&#39;bx&#39;</span><span class="p">]</span>
        <span class="n">by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span><span class="p">][</span><span class="s1">&#39;by&#39;</span><span class="p">]</span>
        <span class="n">bz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span><span class="p">][</span><span class="s1">&#39;bz&#39;</span><span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_dims</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spacing</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;bx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;bz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bz</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;vectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;bx&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;bz&#39;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector_items</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;bx&#39;</span><span class="p">,</span> <span class="s1">&#39;by&#39;</span><span class="p">,</span> <span class="s1">&#39;bz&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;mapBottomSelector&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;map_bottom&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mapBottomSelector</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">map_bottom</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_slice_slider_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_scalar_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">)</span></div>



<div class="viewcode-block" id="MagFieldViewer.init_plot">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.init_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes and displays the plot with the magnetic field data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_slice_slider_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_scalar_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_val</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">:</span> <span class="n">_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_plot">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the plot based on the current input parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updating_flag</span><span class="p">:</span>  <span class="c1"># Check if already updating</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updating_flag</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the flag</span>

        <span class="c1"># Get current parameters</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmax</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="p">])</span>
        <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymax</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="p">])</span>
        <span class="n">center_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="p">])</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="p">])</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_points_input</span><span class="p">],</span>
                                       <span class="n">to_int</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_plane</span><span class="p">()</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_selector</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_scalar_range</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
        <span class="n">slice_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">])</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">,</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">],</span>
                                   <span class="n">paired_widget</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">,</span> <span class="n">paired_type</span><span class="o">=</span><span class="s1">&#39;vmin&#39;</span><span class="p">)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">,</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_valid_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax_input</span><span class="p">],</span>
                                   <span class="n">paired_widget</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin_input</span><span class="p">,</span> <span class="n">paired_type</span><span class="o">=</span><span class="s1">&#39;vmax&#39;</span><span class="p">)</span>
        <span class="n">sphere_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">plane_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_visible</span>
        <span class="n">use_interp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_checkbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span>

        <span class="c1"># Create a dictionary of current parameters</span>
        <span class="n">current_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;center_x&quot;</span><span class="p">:</span> <span class="n">center_x</span><span class="p">,</span>
            <span class="s2">&quot;center_y&quot;</span><span class="p">:</span> <span class="n">center_y</span><span class="p">,</span>
            <span class="s2">&quot;center_z&quot;</span><span class="p">:</span> <span class="n">center_z</span><span class="p">,</span>
            <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
            <span class="s2">&quot;slice_z&quot;</span><span class="p">:</span> <span class="n">slice_z</span><span class="p">,</span>
            <span class="s2">&quot;n_points&quot;</span><span class="p">:</span> <span class="n">n_points</span><span class="p">,</span>
            <span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="n">vmin</span><span class="p">,</span>
            <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="n">vmax</span><span class="p">,</span>
            <span class="s2">&quot;scalar&quot;</span><span class="p">:</span> <span class="n">scalar</span><span class="p">,</span>
            <span class="s2">&quot;use_interp&quot;</span><span class="p">:</span> <span class="n">use_interp</span><span class="p">,</span>
            <span class="s2">&quot;sphere_visible&quot;</span><span class="p">:</span> <span class="n">sphere_visible</span><span class="p">,</span>
            <span class="s2">&quot;plane_visible&quot;</span><span class="p">:</span> <span class="n">plane_visible</span>
        <span class="p">}</span>

        <span class="c1"># Check if parameters have changed</span>
        <span class="k">if</span> <span class="n">current_params</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updating_flag</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Reset the flag</span>
            <span class="k">return</span>

        <span class="c1"># Update only relevant objects based on parameter changes</span>
        <span class="k">if</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;slice_z&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;slice_z&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;scalar&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scalar&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;use_interp&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_interp&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_slice</span><span class="p">(</span><span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;slice_z&#39;</span><span class="p">],</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;scalar&#39;</span><span class="p">],</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span>
                              <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;use_interp&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;plane_visible&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plane_visible&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_plane_visibility</span><span class="p">(</span><span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;plane_visible&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">init</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_x&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center_x&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_y&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center_y&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_z&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center_z&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;n_points&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_points&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_streamlines</span><span class="p">(</span><span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_x&#39;</span><span class="p">],</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_y&#39;</span><span class="p">],</span>
                                        <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;center_z&#39;</span><span class="p">],</span>
                                        <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">],</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;n_points&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;sphere_visible&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sphere_visible&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere_visibility</span><span class="p">(</span><span class="n">current_params</span><span class="p">[</span><span class="s1">&#39;sphere_visible&#39;</span><span class="p">])</span>

        <span class="c1"># Update previous parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_params</span> <span class="o">=</span> <span class="n">current_params</span>

        <span class="c1"># self.plotter.show()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updating_flag</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Reset the flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_camera_clipping_range</span><span class="p">()</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_slice">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_slice">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_z</span><span class="p">,</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">use_interp</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the slice plot based on the given parameters.</span>

<span class="sd">        :param slice_z: float</span>
<span class="sd">            The Z coordinate for the slice.</span>
<span class="sd">        :param scalar: str</span>
<span class="sd">            The scalar field to use for the slice.</span>
<span class="sd">        :param vmin: float</span>
<span class="sd">            The minimum value for the color scale.</span>
<span class="sd">        :param vmax: float</span>
<span class="sd">            The maximum value for the color scale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scalar</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_name</span><span class="p">:</span>
            <span class="c1"># Display the new scalar data as a 2D plane</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalar</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span>
                                                        <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_bottom</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalar</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span>
                                                        <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slice_z</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">slice_z</span> <span class="o">=</span> <span class="mf">1.0e-6</span>
            <span class="k">if</span> <span class="n">use_interp</span><span class="p">:</span>
                <span class="n">new_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slice_z</span><span class="p">))</span>
                <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
                <span class="n">scalar_name</span> <span class="o">=</span> <span class="n">scalar</span>
                <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalar_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spacing_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_spacing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">slice_z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">spacing_z</span><span class="p">))</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">z_pos</span> <span class="o">=</span> <span class="n">slice_z</span>

                <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_dims</span>
                <span class="k">if</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;bx&#39;</span><span class="p">,</span> <span class="s1">&#39;by&#39;</span><span class="p">,</span> <span class="s1">&#39;bz&#39;</span><span class="p">):</span>
                    <span class="n">cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span><span class="p">][</span><span class="n">scalar</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span><span class="p">][</span><span class="s1">&#39;bz&#39;</span><span class="p">]</span>

                <span class="n">cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cube</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;bx&#39;</span><span class="p">,</span> <span class="s1">&#39;by&#39;</span><span class="p">,</span> <span class="s1">&#39;bz&#39;</span><span class="p">):</span>
                    <span class="n">comp_idx</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bx&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;by&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bz&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="n">scalar</span><span class="p">]</span>
                    <span class="n">cube</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">comp_idx</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">cube</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">cube</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">nz</span><span class="p">:</span>
                    <span class="n">cube</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">cube</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">slice_data</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">cube</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cube</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">:</span>
                    <span class="n">slice_data</span> <span class="o">=</span> <span class="n">cube</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Fallback to interpolated slice if cube shape is unexpected</span>
                    <span class="n">new_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slice_z</span><span class="p">))</span>
                    <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
                    <span class="n">scalar_name</span> <span class="o">=</span> <span class="n">scalar</span>
                    <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalar_name</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">slice_data</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">slice_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">:</span>
                        <span class="n">slice_data</span> <span class="o">=</span> <span class="n">slice_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Fallback to interpolated slice if reshaping is impossible</span>
                        <span class="n">new_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slice_z</span><span class="p">))</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
                        <span class="n">scalar_name</span> <span class="o">=</span> <span class="n">scalar</span>
                        <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalar_name</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span>
                        <span class="k">return</span>

                <span class="n">flat_slice</span> <span class="o">=</span> <span class="n">slice_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="n">spacing_x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_xmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
                <span class="n">spacing_y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_ymax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
                <span class="n">scalar_name</span> <span class="o">=</span> <span class="s2">&quot;slice_scalar&quot;</span>
                <span class="n">new_slice</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                         <span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="n">spacing_x</span><span class="p">,</span> <span class="n">spacing_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                         <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="p">,</span> <span class="n">z_pos</span><span class="p">))</span>
                <span class="n">new_slice</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_slice</span>
                <span class="n">new_slice</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="n">scalar_name</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
                <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span>
                <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalar_name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bottom_slice_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">new_slice</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="n">pref</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.create_streamlines">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.create_streamlines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">streamlines</span><span class="p">(</span><span class="n">vectors</span><span class="o">=</span><span class="s1">&#39;vectors&#39;</span><span class="p">,</span> <span class="n">source_center</span><span class="o">=</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">),</span>
                                                 <span class="n">source_radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="n">n_points</span><span class="p">,</span> <span class="n">integration_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                                 <span class="n">max_time</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span><span class="o">.</span><span class="n">n_points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">streamlines_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlines</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No streamlines generated.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_streamlines">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_streamlines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the streamline plot based on the given parameters.</span>

<span class="sd">        :param center_x: float</span>
<span class="sd">            The X coordinate of the center of the sphere.</span>
<span class="sd">        :param center_y: float</span>
<span class="sd">            The Y coordinate of the center of the sphere.</span>
<span class="sd">        :param center_z: float</span>
<span class="sd">            The Z coordinate of the center of the sphere.</span>
<span class="sd">        :param radius: float</span>
<span class="sd">            The radius of the sphere.</span>
<span class="sd">        :param n_points: int</span>
<span class="sd">            The number of seed points for the streamlines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">]</span>
        <span class="n">streamlines_actor</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span>
        <span class="n">streamlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">streamlines</span><span class="p">(</span><span class="n">vectors</span><span class="o">=</span><span class="s1">&#39;vectors&#39;</span><span class="p">,</span> <span class="n">source_center</span><span class="o">=</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">),</span>
                                            <span class="n">source_radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="n">n_points</span><span class="p">,</span> <span class="n">integration_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                            <span class="n">max_time</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;streamlines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlines</span>
        <span class="k">if</span> <span class="n">streamlines</span><span class="o">.</span><span class="n">n_points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">streamlines_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">streamlines_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">streamlines</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="n">streamlines_actor</span><span class="p">)</span>
                <span class="n">streamlines_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">streamlines</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">pickable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlines_actor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No streamlines generated.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_sphere">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_sphere">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the sphere widget based on the current input parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;sphere_actor&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">]:</span>
                <span class="n">sphere_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sphere_actor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sphere_actor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sphere_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">center_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">center_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">center_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="n">sphere_actor</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">])</span>
            <span class="n">sphere_actor</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;radius&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span></div>



<div class="viewcode-block" id="MagFieldViewer.on_lock_z_changed">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.on_lock_z_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_lock_z_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
                <span class="n">center_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">center_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">center_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">RemoveAllObservers</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_widget</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_sphere_constrained_move</span><span class="p">,</span>
                    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">),</span>
                    <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                    <span class="n">theta_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                    <span class="n">phi_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="s1">&#39;wireframe&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">]</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">RemoveAllObservers</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_widget</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_sphere_moved</span><span class="p">,</span>
                    <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                    <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                    <span class="n">theta_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                    <span class="n">phi_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="s1">&#39;wireframe&#39;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_sphere_visibility">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_sphere_visibility">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_sphere_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sphere_visible</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the visibility of the sphere widget.</span>

<span class="sd">        :param sphere_visible: bool</span>
<span class="sd">            Whether the sphere widget is visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;sphere_actor&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">]:</span>
                <span class="n">sphere_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sphere_actor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sphere_actor</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_visible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere_visible</span>
        <span class="k">if</span> <span class="n">sphere_visible</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sphere_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">center_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">center_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">center_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">move_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_sphere_constrained_move</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_z_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_sphere_moved</span>
                <span class="c1"># move_callback = self._on_sphere_moved</span>
                <span class="n">sphere_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere_widget</span><span class="p">(</span><span class="n">move_callback</span><span class="p">,</span>
                                                      <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span><span class="p">),</span>
                                                      <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">theta_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">phi_resolution</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                                                      <span class="n">style</span><span class="o">=</span><span class="s1">&#39;wireframe&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere_actor</span>
                <span class="c1"># self.spheres[self.current_sphere_id][&#39;initial_position&#39;] = (center_x, center_y, center_z)</span>
                <span class="c1"># sphere_actor.AddObserver(&quot;StartInteractionEvent&quot;, self.start_sphere_interaction)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sphere_actor</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sphere_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sphere_actor</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="o">!=</span> <span class="n">sphere_visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">sphere_visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_sphere_visibility</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_sphere_moved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the event when the sphere widget is moved.</span>

<span class="sd">        :param center: list of float</span>
<span class="sd">            The new center coordinates of the sphere.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_sphere_constrained_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the sphere in the plane z = center_z_input when &#39;Lock Z&#39; is checked.</span>

<span class="sd">        :param center: list of float</span>
<span class="sd">            The new center coordinates of the sphere.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fixed_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># Update the sphere&#39;s position but constrain the Z coordinate to fixed_z</span>
        <span class="n">new_sphere_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fixed_z</span><span class="p">]</span>

        <span class="c1"># Update the sphere actor position</span>
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_sphere_id</span><span class="p">][</span><span class="s1">&#39;sphere_actor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">new_sphere_pos</span><span class="p">)</span>


        <span class="c1"># Update the input fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_x_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_y_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sphere</span><span class="p">()</span>

<div class="viewcode-block" id="MagFieldViewer.toggle_sphere_visibility">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.toggle_sphere_visibility">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_sphere_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the visibility of the sphere widget.</span>

<span class="sd">        :param state: int</span>
<span class="sd">            The state of the checkbox (checked or unchecked).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Hide the sphere&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viz_sphere_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Show the sphere&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_visible</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_plane">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_plane">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the plane widget based on the current input parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">slice_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">)</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">([</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slice_z</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span></div>


<div class="viewcode-block" id="MagFieldViewer.update_plane_visibility">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.update_plane_visibility">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plane_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane_visible</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the visibility of the plane widget.</span>

<span class="sd">        :param plane_visible: bool</span>
<span class="sd">            Whether the plane widget is visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plane_visible</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">slice_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">)</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_plane_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_plane_moved</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span>
                                                         <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slice_z</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_zmax</span><span class="p">),</span>
                                                         <span class="n">normal_rotation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plane_actor</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_plane_moved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the event when the plane widget is moved.</span>

<span class="sd">        :param normal: list of float</span>
<span class="sd">            The normal vector of the plane.</span>
<span class="sd">        :param origin: list of float</span>
<span class="sd">            The new origin coordinates of the plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice_z_input</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plane</span><span class="p">()</span>

<div class="viewcode-block" id="MagFieldViewer.toggle_plane_visibility">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.toggle_plane_visibility">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_plane_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the visibility of the plane widget.</span>

<span class="sd">        :param state: int</span>
<span class="sd">            The state of the checkbox (checked or unchecked).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_visible</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span></div>


<div class="viewcode-block" id="MagFieldViewer.send_streamlines">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.send_streamlines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">send_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the streamline data of all spheres to the parent object (if any).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending streamlines to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">streamlines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheres</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines_actor&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">n_lines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">streamlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="s1">&#39;streamlines&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">streamlines</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plot_fieldlines</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">z_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_zbase</span><span class="p">)</span></div>



<div class="viewcode-block" id="MagFieldViewer.save_box">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.save_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">box_dims_str</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">dims_pix</span><span class="p">))</span>
        <span class="n">default_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;b3d_data_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">_frame_obs</span><span class="o">.</span><span class="n">obstime</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_dim</span><span class="si">{</span><span class="n">box_dims_str</span><span class="si">}</span><span class="s1">.h5&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Save Box&quot;</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="s2">&quot;HDF5 Files (*.h5)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">write_b3d_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">)</span></div>


<div class="viewcode-block" id="MagFieldViewer.load_box">
<a class="viewcode-back" href="../../../autoapi/pyampp/gxbox/magfield_viewer/index.html#pyampp.gxbox.magfield_viewer.MagFieldViewer.load_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default_filename</span> <span class="o">=</span> <span class="s2">&quot;b3d_data.h5&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Load Box&quot;</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="s2">&quot;HDF5 Files (*.h5)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span> <span class="o">=</span> <span class="n">read_b3d_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;corona&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="s2">&quot;corona&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;nlfff&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="s2">&quot;corona&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="s2">&quot;corona&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;nlfff&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;pot&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="s2">&quot;corona&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="s2">&quot;corona&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pot&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;chromo&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b3dtype</span> <span class="o">=</span> <span class="s2">&quot;chromo&quot;</span>
            <span class="n">chromo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chromo&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="s2">&quot;bx&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chromo</span> <span class="ow">and</span> <span class="s2">&quot;bcube&quot;</span> <span class="ow">in</span> <span class="n">chromo</span><span class="p">:</span>
                <span class="n">bcube</span> <span class="o">=</span> <span class="n">chromo</span><span class="p">[</span><span class="s2">&quot;bcube&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">bcube</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">bcube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">chromo</span><span class="p">[</span><span class="s2">&quot;bx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">chromo</span><span class="p">[</span><span class="s2">&quot;by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">chromo</span><span class="p">[</span><span class="s2">&quot;bz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b3d</span><span class="p">[</span><span class="s2">&quot;chromo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, suncast-org.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>