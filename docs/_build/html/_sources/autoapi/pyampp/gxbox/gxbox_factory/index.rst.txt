pyampp.gxbox.gxbox_factory
==========================

.. py:module:: pyampp.gxbox.gxbox_factory


Attributes
----------

.. autoapisummary::

   pyampp.gxbox.gxbox_factory.app


Classes
-------

.. autoapisummary::

   pyampp.gxbox.gxbox_factory.GxBox


Functions
---------

.. autoapisummary::

   pyampp.gxbox.gxbox_factory.main


Module Contents
---------------

.. py:data:: app

.. py:class:: GxBox(time, observer, box_orig, box_dims=u.Quantity([100, 100, 100]) * u.pix, box_res=1.4 * u.Mm, pad_frac=0.1, data_dir=DOWNLOAD_DIR, gxmodel_dir=GXMODEL_DIR, external_box=None, execute_cmd: str | None = None, save_empty_box: bool = False, save_bounds: bool = False, save_potential: bool = False, save_nas: bool = False, save_gen: bool = False, save_chr: bool = False, stop_after: str | None = None, auto_visualize_last: bool = True, euv: bool = True, uv: bool = True, hmifiles: str | None = None, entry_box: str | None = None, empty_box_only: bool = False, potential_only: bool = False, use_potential: bool = False, jump2potential: bool = False, jump2nlfff: bool = False, jump2lines: bool = False, jump2chromo: bool = False)

   Bases: :py:obj:`PyQt5.QtWidgets.QMainWindow`


   .. py:attribute:: time


   .. py:attribute:: observer


   .. py:attribute:: box_dims


   .. py:attribute:: box_res


   .. py:attribute:: pad_frac
      :value: 0.1



   .. py:attribute:: box_origin


   .. py:attribute:: gxmodel_dir


   .. py:attribute:: auto_save_stages
      :value: True



   .. py:attribute:: execute_cmd
      :value: None



   .. py:attribute:: save_empty_box
      :value: False



   .. py:attribute:: save_bounds
      :value: False



   .. py:attribute:: save_potential
      :value: False



   .. py:attribute:: save_nas
      :value: False



   .. py:attribute:: save_gen
      :value: False



   .. py:attribute:: save_chr
      :value: False



   .. py:attribute:: stop_after
      :value: None



   .. py:attribute:: auto_visualize_last
      :value: True



   .. py:attribute:: euv
      :value: True



   .. py:attribute:: uv
      :value: True



   .. py:attribute:: hmifiles
      :value: None



   .. py:attribute:: entry_box
      :value: None



   .. py:attribute:: empty_box_only
      :value: False



   .. py:attribute:: potential_only
      :value: False



   .. py:attribute:: use_potential
      :value: False



   .. py:attribute:: jump2potential
      :value: False



   .. py:attribute:: jump2nlfff
      :value: False



   .. py:attribute:: jump2lines
      :value: False



   .. py:attribute:: jump2chromo
      :value: False



   .. py:attribute:: sdofitsfiles
      :value: None



   .. py:attribute:: frame_hcc


   .. py:attribute:: frame_obs


   .. py:attribute:: frame_hgs


   .. py:attribute:: lines_of_sight
      :value: []



   .. py:attribute:: edge_coords
      :value: []



   .. py:attribute:: axes
      :value: None



   .. py:attribute:: fig
      :value: None



   .. py:attribute:: axes_world_coords
      :value: None



   .. py:attribute:: axes_world_coords_init
      :value: None



   .. py:attribute:: init_map_context_name
      :value: '171'



   .. py:attribute:: init_map_bottom_name
      :value: 'field'



   .. py:attribute:: external_box
      :value: None



   .. py:attribute:: fieldlines_coords
      :value: []



   .. py:attribute:: fieldlines_line_collection
      :value: []



   .. py:attribute:: fieldlines_show_status
      :value: True



   .. py:attribute:: map_context_im
      :value: None



   .. py:attribute:: map_bottom_im
      :value: None



   .. py:method:: box_norm_direction()


   .. py:method:: box_view_up()


   .. py:method:: load_gxbox(boxfile)


   .. py:property:: avaliable_maps

      Lists the available maps.

      :return: A list of available map keys.
      :rtype: list


   .. py:method:: corr_fov_coords(sunpymap, fov_coords)

      Corrects the field of view coordinates using the given map.
      :param sunpymap: The map to use for correction.
      :type sunpymap: sunpy.map.Map
      :param fov_coords: The field of view coordinates (bottom left and top right) as SkyCoord objects.
      :type fov_coords: list

      :return: Corrected field of view coordinates.
      :rtype: list



   .. py:method:: loadmap(mapname, fov_coords=None)

      Loads a map from the available data.

      :param mapname: Name of the map to load.
      :type mapname: str
      :param fov_coords: Field of view coordinates (bottom left and top right) as SkyCoord objects, optional. Defaults to the entire FOV if not specified.
      :type fov_coords: list, optional
      :return: The requested map.
      :raises ValueError: If the specified map is not available.



   .. py:method:: make_dummy_map(ref_coord)

      Creates a dummy map for initialization purposes.

      :param ref_coord: Reference coordinate for the map.
      :type ref_coord: `~astropy.coordinates.SkyCoord`
      :return: The created dummy map.
      :rtype: sunpy.map.Map



   .. py:method:: init_ui()

      Initializes the user interface for the GxBox application.



   .. py:method:: calc_potential_field()


   .. py:method:: calc_nlfff()


   .. py:method:: calc_chromo_model()


   .. py:method:: visualize_3d_magnetic_field()

      Launches the MagneticFieldVisualizer to visualize the 3D magnetic field data.



   .. py:method:: update_bottom_map(map_name)

      Updates the bottom map displayed in the UI.

      :param map_name: Name of the map to be updated.
      :type map_name: str



   .. py:method:: update_context_map(map_name)

      Updates the context map displayed in the UI.

      :param map_name: Name of the map to be updated.
      :type map_name: str



   .. py:property:: get_axes_world_coords


   .. py:method:: get_axes_pixel_coords(coords_world=None)


   .. py:method:: toggle_fieldlines_visibility()

      Toggles the visibility of the fieldlines from the plot.



   .. py:method:: clear_fieldlines()

      Clears the fieldlines from the plot.



   .. py:method:: update_plot(show_bound_box=True, show_box_outline=True)

      Updates the plot with the current data and settings.



   .. py:method:: extract_streamlines(streamlines)

      Extracts individual streamlines from the streamlines data.

      :param streamlines: pyvista.PolyData
          The streamlines data.
      :return: list of numpy.ndarray
          A list of individual streamlines.



   .. py:method:: plot_fieldlines(streamlines, z_base=0.0)

      Plots the extracted fieldlines with colorization based on their magnitude.

      :param streamlines: pyvista.PolyData
          The streamlines data.



   .. py:method:: save_fieldlines(default_filename='fieldlines.pkl')

      Saves the fieldlines data to a file. Prompts the user to select a directory and input a filename.

      :param default_filename: str
          The default name of the file to save the fieldlines data.



   .. py:method:: plot()

      Plots the data in the UI.



   .. py:method:: create_lines_of_sight()

      Creates lines of sight for the visualization.



   .. py:method:: visualize()

      Visualizes the data in the UI.



.. py:function:: main(time: Optional[str] = typer.Option(None, '--time', help='Observation time in ISO format, e.g., "2024-05-12T00:00:00".'), coords: Optional[Tuple[float, float]] = typer.Option(None, '--coords', help='Two floats: [x, y] (arcsec if HPC, degrees if HGC or HGS). Example: 0.0 0.0'), hpc: bool = typer.Option(False, '--hpc', help='Use Helioprojective coordinates.'), hgc: bool = typer.Option(False, '--hgc', help='Use Heliographic Carrington coordinates.'), hgs: bool = typer.Option(False, '--hgs', help='Use Heliographic Stonyhurst coordinates.'), box_dims: Optional[Tuple[int, int, int]] = typer.Option((100, 100, 100), '--box-dims', help='Three ints: box dimensions [nx, ny, nz] in pixels. Example: 100 100 100'), box_res: Optional[float] = typer.Option(1.4, '--box-res', help='Box resolution in Mm per pixel.'), observer: Optional[str] = typer.Option('Earth', '--observer', help="Observer location (e.g., 'earth' or a named object)."), pad_frac: Optional[float] = typer.Option(0.25, '--pad-frac', help='Fractional padding applied to each side of the box (decimal).'), data_dir: Optional[str] = typer.Option(DOWNLOAD_DIR, '--data-dir', help='Directory for storing downloaded data.'), gxmodel_dir: Optional[str] = typer.Option(GXMODEL_DIR, '--gxmodel-dir', help='Directory for storing model outputs.'), external_box: Optional[str] = typer.Option(os.path.abspath(os.getcwd()), '--external-box', help='Path to an external box file.'), interactive: bool = typer.Option(False, '--interactive', help='Enable interactive mode (drops into pdb after launching).'), euv: bool = typer.Option(True, '--euv/--no-euv', help='Download AIA/EUV context maps (default: on).'), uv: bool = typer.Option(True, '--uv/--no-uv', help='Download AIA/UV context maps (default: on).'), hmifiles: Optional[str] = typer.Option(None, '--hmifiles', help='Path to a local HMI data directory to bypass downloads.'), entry_box: Optional[str] = typer.Option(None, '--entry-box', help='Path to a preexisting box to use as starting point.'), empty_box_only: bool = typer.Option(False, '--empty-box-only', help='Stop after empty box is generated.'), potential_only: bool = typer.Option(False, '--potential-only', help='Compute only the potential extrapolation and stop.'), use_potential: bool = typer.Option(False, '--use-potential', help='Skip NLFFF and use the potential field for downstream steps.'), jump2potential: bool = typer.Option(False, '--jump2potential', help='Start from entry_box and jump to potential stage.'), jump2nlfff: bool = typer.Option(False, '--jump2nlfff', help='Start from entry_box and jump to NLFFF stage.'), jump2lines: bool = typer.Option(False, '--jump2lines', help='Start from entry_box and jump to lines/GEN stage.'), jump2chromo: bool = typer.Option(False, '--jump2chromo', help='Start from entry_box and jump to chromo stage.'), save_empty_box: bool = typer.Option(False, '--save-empty-box', help='Save the empty box stage (NONE).'), save_bounds: bool = typer.Option(False, '--save-bounds', help='Save the boundary stage (BND).'), save_potential: bool = typer.Option(False, '--save-potential', help='Save the potential stage (POT).'), save_nas: bool = typer.Option(False, '--save-nas', help='Save the NLFFF stage (NAS).'), save_gen: bool = typer.Option(False, '--save-gen', help='Save the GEN stage (NAS.GEN).'), save_chr: bool = typer.Option(False, '--save-chr', help='Save the CHR stage (NAS.CHR).'), stop_after: Optional[str] = typer.Option(None, '--stop-after', help='Stop after stage: pot|nas|gen|chr.'), auto_visualize_last: bool = typer.Option(True, '--auto-visualize-last/--no-auto-visualize-last', help='Auto-launch the 3D viewer for the last stage.'), info: bool = typer.Option(False, '--info', help='Print all explicit and implicit options with their meanings and exit.'))

   Launch the GxBox application with the specified parameters.

   :param time: Observation time in ISO format (e.g., "2024-05-12T00:00:00").
   :type time: str
   :param coords: Two floats representing [x, y] (arcsec if HPC, degrees if HGC or HGS). Example: 0.0 0.0
   :type coords: Tuple[float, float]
   :param hpc: Use Helioprojective coordinates, defaults to False
   :type hpc: bool, optional
   :param hgc: Use Heliographic Carrington coordinates, defaults to False
   :type hgc: bool, optional
   :param hgs: Use Heliographic Stonyhurst coordinates, defaults to False
   :type hgs: bool, optional
   :param box_dims: Three integers [nx, ny, nz] specifying box dimensions in pixels. Example: 100 100 100
                    Defaults to (100, 100, 100).
   :type box_dims: Tuple[int, int, int], optional
   :param box_res: Box resolution in Mm per pixel, defaults to 1.4
   :type box_res: float, optional
   :param observer: Observer location (e.g., 'Earth' or a named object), defaults to "Earth"
   :type observer: str, optional
   :param pad_frac: Fractional padding applied to each side of the box (decimal), defaults to 0.25
   :type pad_frac: float, optional
   :param data_dir: Directory for storing downloaded data, defaults to DOWNLOAD_DIR
   :type data_dir: str, optional
   :param gxmodel_dir: Directory for storing model outputs, defaults to GXMODEL_DIR
   :type gxmodel_dir: str, optional
   :param external_box: Path to an external box file, defaults to current working directory
   :type external_box: str, optional
   :param interactive: Enable interactive mode (drops into pdb after launching), defaults to False
   :type interactive: bool, optional
   :raises typer.BadParameter: If none or multiple coordinate frame flags (--hpc, --hgc, --hgs) are provided
   :return: None
   :rtype: NoneType

   Example:
   --------
   .. code-block:: bash

     gxbox         --time "2022-03-30T17:22:37"         --coords 34.44988566346035 14.26110705696788         --hgs         --box-dims 360 180 200         --box-res 0.729         --pad-frac 0.25         --data-dir /path/to/download_dir         --gxmodel-dir /path/to/gx_models_dir


